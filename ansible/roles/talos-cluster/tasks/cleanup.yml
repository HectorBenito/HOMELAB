---
# Cleanup Talos VMs on failure
# This task file is called when any step in the Talos cluster setup fails

- name: Display cleanup warning
  ansible.builtin.debug:
    msg: |
      ⚠️  Talos cluster setup failed!

      You can retry the setup without destroying VMs by running:
        make layer2

      Or destroy Talos VMs and redeploy (keeps NFS):
        make destroy-talos && make layer1 && make layer2

      Or destroy everything and start fresh:
        make destroy && make deploy

- name: Display cleanup result
  ansible.builtin.debug:
    msg: |
      ℹ️  Cleanup skipped - Talos VMs and configs preserved for retry
      ℹ️  To manually destroy Talos VMs only: make destroy-talos
      ℹ️  To manually destroy all infrastructure: make destroy